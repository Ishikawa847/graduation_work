<div class="container mx-auto px-4 py-12 max-w-2xl">
  <h1 class="text-3xl font-bold text-center mb-8 text-gray-100">
    新しいレシピを投稿
  </h1>

  <%= form_with model: @recipe, local: true, multipart: true, class: "space-y-8" do |form| %>

    <%# エラーメッセージ %>
    <% if @recipe.errors.any? %>
      <div class="bg-red-900/40 border border-red-600 text-red-300 px-4 py-3 rounded-lg">
        <h4 class="font-bold">エラーが発生しました:</h4>
        <ul class="mt-2 list-disc pl-5">
          <% @recipe.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%# 料理名 %>
    <div>
      <%= form.label :name, "料理名", class: "block text-gray-200 text-sm font-semibold mb-2" %>
      <%= form.text_field :name, 
          class: "bg-gray-800 border border-gray-700 rounded w-full py-3 px-4 text-gray-100 placeholder-gray-400 focus:border-blue-500 focus:ring-blue-500" %>
    </div>

    <%# 料理説明 %>
    <div>
      <%= form.label :description, "料理の説明", class: "block text-gray-200 text-sm font-semibold mb-2" %>
      <%= form.text_area :description, rows: 4,
          class: "bg-gray-800 border border-gray-700 rounded w-full py-3 px-4 text-gray-100 placeholder-gray-400 focus:border-blue-500 focus:ring-blue-500" %>
    </div>

    <%# 写真 %>
    <div>
      <%= form.label :image, "料理の写真", class: "block text-gray-200 text-sm font-semibold mb-2" %>

      <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-600 border-dashed rounded-lg bg-gray-800">
        <div class="text-center space-y-2">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor">
            <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" />
          </svg>

          <div class="text-sm text-gray-300">
            <%= form.file_field :image, class: "sr-only", id: "image-upload", accept: "image/*" %>
            <label for="image-upload"
              class="cursor-pointer bg-gray-700 px-3 py-1 rounded text-blue-400 hover:text-blue-300">
              写真をアップロード
            </label>
            <p>またはドラッグ&ドロップ</p>
          </div>

          <p class="text-xs text-gray-400">PNG, JPG, GIF (最大5MB)</p>
        </div>
      </div>
    </div>

    <%# 材料欄 %>
    <div>
      <h3 class="text-lg font-bold text-gray-100 mb-4">材料</h3>

      <div id="ingredients-container">
        <%= form.fields_for :recipe_ingredients do |ingredient_form| %>
          <div class="ingredient-item mb-4 p-4 border border-gray-700 rounded-lg bg-gray-800">
            <div class="grid grid-cols-1 md:grid-cols-6 gap-4">

              <div class="md:col-span-2">
                <%= ingredient_form.label :ingredient_name, "食材名", class: "block text-sm font-medium text-gray-200 mb-1" %>
                <%= ingredient_form.text_field :ingredient_name,
                      class: "w-full rounded-md bg-gray-900 border-gray-700 text-gray-100 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500" %>
              </div>

              <div>
                <%= ingredient_form.label :quantity, "分量(g)", class: "block text-sm font-medium text-gray-200 mb-1" %>
                <%= ingredient_form.number_field :quantity,
                      class: "w-full rounded-md bg-gray-900 border-gray-700 text-gray-100 placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500",
                      min: 1 %>
              </div>

              <div>
                <%= ingredient_form.label :protein_per_100g, "タンパク質", class: "block text-sm font-medium text-gray-200 mb-1" %>
                <%= ingredient_form.number_field :protein_per_100g, step: 0.1,
                      class: "w-full rounded-md bg-gray-900 border-gray-700 text-gray-100 focus:border-blue-500 focus:ring-blue-500" %>
                <span class="text-xs text-gray-400">g/100g</span>
              </div>

              <div>
                <%= ingredient_form.label :fat_per_100g, "脂質", class: "block text-sm font-medium text-gray-200 mb-1" %>
                <%= ingredient_form.number_field :fat_per_100g, step: 0.1,
                      class: "w-full rounded-md bg-gray-900 border-gray-700 text-gray-100 focus:border-blue-500 focus:ring-blue-500" %>
                <span class="text-xs text-gray-400">g/100g</span>
              </div>

              <div>
                <%= ingredient_form.label :carbohydrate_per_100g, "炭水化物", class: "block text-sm font-medium text-gray-200 mb-1" %>
                <%= ingredient_form.number_field :carbohydrate_per_100g, step: 0.1,
                      class: "w-full rounded-md bg-gray-900 border-gray-700 text-gray-100 focus:border-blue-500 focus:ring-blue-500" %>
                <span class="text-xs text-gray-400">g/100g</span>
              </div>

            </div>

            <div class="mt-3 flex justify-end">
              <button type="button"
                class="remove-ingredient bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm">
                削除
              </button>
            </div>
          </div>
        <% end %>
      </div>

      <button type="button" id="add-ingredient"
        class="mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
        + 材料を追加
      </button>
    </div>

    <%# 送信 %>
    <div class="flex justify-center">
      <%= form.submit "レシピを投稿",
            class: "bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition transform hover:scale-105" %>
    </div>

  <% end %>

  <div class="text-center mt-8">
    <%= link_to "レシピ一覧に戻る", recipes_path,
          class: "text-blue-400 hover:text-blue-300 underline" %>
  </div>
</div>
