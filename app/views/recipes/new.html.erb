<div class="container mx-auto px-4 py-8 max-w-2xl">
  <h1 class="text-3xl font-bold text-center mb-6">新しいレシピを投稿</h1>

  <%= form_with model: @recipe, local: true, multipart: true, class: "space-y-6" do |form| %>
    
    <%# エラーメッセージ表示 %>
    <% if @recipe.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
        <h4 class="font-bold">エラーが発生しました:</h4>
        <ul class="mt-2">
          <% @recipe.errors.full_messages.each do |message| %>
            <li>• <%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%# 料理名 %>
    <div class="mb-6">
      <%= form.label :name, "料理名", class: "block text-gray-700 text-sm font-bold mb-2" %>
      <%= form.text_field :name, class: "shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline", placeholder: "例：チキンカレー" %>
    </div>

    <%# 料理の説明 %>
    <div class="mb-6">
      <%= form.label :description, "料理の説明", class: "block text-gray-700 text-sm font-bold mb-2" %>
      <%= form.text_area :description, rows: 4, class: "shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline", placeholder: "この料理の特徴や美味しさのポイントを教えてください" %>
    </div>

    <%# 写真アップロード %>
    <div class="mb-6">
      <%= form.label :image, "料理の写真", class: "block text-gray-700 text-sm font-bold mb-2" %>
      <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
        <div class="space-y-1 text-center">
          <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <div class="text-sm text-gray-600">
            <%= form.file_field :image, class: "sr-only", id: "image-upload", accept: "image/*" %>
            <label for="image-upload" class="cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
              <span>写真をアップロード</span>
            </label>
            <p class="pl-1">またはドラッグ&ドロップ</p>
          </div>
          <p class="text-xs text-gray-500">PNG, JPG, GIF (最大5MB)</p>
        </div>
      </div>
    </div>
<div class="mb-6">
  <h3 class="text-lg font-bold text-gray-700 mb-4">材料</h3>
  <div id="ingredients-container">
    <%= form.fields_for :recipe_ingredients do |ingredient_form| %>
      <div class="ingredient-item mb-4 p-4 border rounded-lg bg-gray-50">
        <div class="grid grid-cols-1 md:grid-cols-6 gap-3">
          <!-- 材料名入力 -->
          <div class="md:col-span-2">
            <%= ingredient_form.label :ingredient_name, "食材名", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= ingredient_form.text_field :ingredient_name, 
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", 
                  placeholder: "例：鶏むね肉" %>
          </div>
          
          <!-- 分量 -->
          <div>
            <%= ingredient_form.label :quantity, "分量(g)", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= ingredient_form.number_field :quantity, 
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", 
                  placeholder: "100", min: 1 %>
          </div>
          
          <!-- PFC値入力（100gあたり） -->
          <div>
            <%= ingredient_form.label :protein_per_100g, "タンパク質", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= ingredient_form.number_field :protein_per_100g, 
                  step: 0.1,
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", 
                  placeholder: "23.3" %>
            <span class="text-xs text-gray-500">g/100g</span>
          </div>
          
          <div>
            <%= ingredient_form.label :fat_per_100g, "脂質", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= ingredient_form.number_field :fat_per_100g, 
                  step: 0.1,
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", 
                  placeholder: "1.5" %>
            <span class="text-xs text-gray-500">g/100g</span>
          </div>
          
          <div>
            <%= ingredient_form.label :carbohydrate_per_100g, "炭水化物", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= ingredient_form.number_field :carbohydrate_per_100g, 
                  step: 0.1,
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", 
                  placeholder: "0" %>
            <span class="text-xs text-gray-500">g/100g</span>
          </div>
        </div>
        
        <div class="mt-3 flex justify-end">
          <button type="button" class="remove-ingredient bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm">
            削除
          </button>
        </div>
      </div>
    <% end %>
  </div>
  
  <button type="button" id="add-ingredient" class="mt-3 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
    + 材料を追加
  </button>
</div>
    <div class="flex items-center justify-center">
      <%= form.submit "レシピを投稿", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-200 ease-in-out transform hover:scale-105" %>
    </div>
  <% end %>

  <%# 戻るリンク %>
  <div class="text-center mt-6">
    <%= link_to "レシピ一覧に戻る", recipes_path, class: "text-blue-500 hover:text-blue-700 underline" %>
  </div>
</div>